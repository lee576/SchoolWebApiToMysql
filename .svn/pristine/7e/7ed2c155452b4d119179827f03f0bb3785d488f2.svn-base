<template>
    <div class="home">
        <div class="nav">
            <div class="nav_bread">
                <el-breadcrumb separator-class="el-icon-arrow-right">
                    <el-breadcrumb-item>校园卡管理</el-breadcrumb-item>
                    <el-breadcrumb-item>管理</el-breadcrumb-item>
                </el-breadcrumb>
                <el-row>
                    <router-link to="/cardadmin">
                        <el-button plain size="small" class="details">
                            <div class="det_btn">返回</div>
                        </el-button>
                    </router-link>
                </el-row>
            </div>
            <el-row>
                <el-button type="primary" size="small" class="release" round @click="ImmediatelyRelease">
                    立即发布
                </el-button>
            </el-row>
        </div>
        <div class="container">
            <div class="card_set">
                <div class="al_set">
                    <div class="al_title">
                        卡包设置
                    </div>
                    <div class="template">
                        <div class="template_title">{{phoneSurface.cardname}}</div>
                        <div class="phone">
                            <div class="template_phone">
                                <div class="phone_border">

                                    <div class="phone_content" style="margin:20px 10px">
                                        <div class="phone_background">
                                            <div class="phone_backpic">
                                                <el-upload
                                                        class="avatar-uploader "
                                                        action="http://192.168.1.7/api/SchoolCodr/Upload"
                                                        :show-file-list="false"
                                                        :on-success="handleAvatarSuccess"
                                                        :before-upload="beforeAvatarUpload"
                                                        :data="picback_data"
                                                        style="width: 100%;height: 110px;background: rgba(241,241,241,1);border-radius: 10px 10px 10px 10px;">
                                                    <img v-if="imageback" :src="imageback"
                                                         class=" width: 100%;height: 110px;">
                                                    <i v-else class="el-icon-plus avatar-uploader-icon"
                                                       style="display: inline-block;width: 100%;color: rgba(112,112,112,1);"></i>
                                                </el-upload>
                                            </div>
                                            <!--<div class="phone_icon">-->
                                            <!--<el-upload-->
                                            <!--class="avatar-uploader"-->
                                            <!--action="https://jsonplaceholder.typicode.com/posts/"-->
                                            <!--:show-file-list="false"-->
                                            <!--:on-success="handleAvatarSuccess"-->
                                            <!--:before-upload="beforeAvatarUpload">-->
                                            <!--<img v-if="imageUrl" :src="imageUrl" class="avatar">-->
                                            <!--<i v-else class="el-icon-plus avatar-uploader-icon"></i>-->
                                            <!--</el-upload>-->
                                            <!--</div>-->
                                        </div>
                                        <div class="phone_code">
                                            <div class="phone_payment">
                                                <div class="paymentCode" @click="SelectedPaymentcode">付款码</div>
                                                <div class="campusCode" @click="SelectedCampuscode">校园码</div>
                                            </div>

                                        </div>
                                        <div class="phone_campus" v-for="(typename,index) in typenames">
                                            <div style="border-left:3px solid rgba(34,135,251,1);"
                                                 class="phone_campus_title">
                                                <span style="color: rgba(112,112,112,1);">{{typename}}</span>
                                                <span @click="alter(typename)">修改</span>
                                                <el-dialog
                                                        title="修改分组"
                                                        :visible.sync="AlterDispatch"
                                                        width="30%"
                                                        :before-close="handleClose">

                                                    <!--<el-input v-model="typename"  placeholder="活动名称"></el-input>-->
                                                    <span slot="footer" class="dialog-footer">
                                                    <el-button @click="AlterDispatch = false">取 消</el-button>
                                                    <el-button type="primary"
                                                               @click="AlterDispatch = false">确 定</el-button>
                                                  </span>
                                                </el-dialog>
                                                <span @click="deleteIcon(index)">删除</span>
                                            </div>
                                            <div class="phone_function"
                                                 style="display: flex;flex-wrap: wrap;margin-top: 5px"
                                                 v-show="layout===0">
                                                <div v-for="(column_list,index) in column_info_list"
                                                     style="margin:6px;position: relative"
                                                     @dblclick="Changenavigation(column_list)">
                                                    <img :src="imageDelete" alt="" v-if="show"
                                                         style="position: absolute;top: -10px;left: 13px;"
                                                         @click="DeleteItem(index)"
                                                    >
                                                    <img :src="listpic.url"
                                                         style="width: 45px;height: 45px;">
                                                    <div style="font-size:12px;white-space:nowrap;overflow:hidden;width: 48px">
                                                        {{column_list.title}}
                                                    </div>
                                                </div>
                                                <div style="margin: 6px" @click="addnavigation">
                                                    <img src="../../../assets/images/add.jpg"
                                                         style="width: 45px;height: 45px;margin-left:2px">
                                                    <div style="font-size:12px;">
                                                        新增导航
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="phone_function" v-show="layout===1">
                                                <div v-for="column_list in column_info_list" style="margin:5px 0px;
height: 34px;
background: rgba(241,241,241,1);
border-radius: 5px 5px 5px 5px;
border: 1px solid rgba(112,112,112,0.2);
display: flex;
align-items:Center;
padding: 0 10px;
justify-content: space-between
"
                                                     @dblclick="Changenavigation(column_list)">

                                                    <div style="font-size:12px;white-space:nowrap;overflow:hidden;width: 48px">
                                                        {{column_list.title}}
                                                    </div>
                                                    <div>
                                                        <img src="../../../assets/images/open.jpg" alt="">
                                                    </div>
                                                </div>
                                                <div style="margin: 5px 0px;
height: 34px;
background: rgba(241,241,241,1);
border-radius: 5px 5px 5px 5px;
border: 1px solid rgba(112,112,112,0.2);
display: flex;
align-items:Center;
padding: 0 10px;
justify-content: space-between "
                                                     @click="addnavigation">
                                                    <div style="font-size:12px;">
                                                        新增导航
                                                    </div>
                                                    <div>
                                                        <img src="../../../assets/images/open.jpg" alt="">
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div style="border-radius:5px;padding:1px 10px;font-size: 12px;color: rgba(255,255,255,1); width: 60px;height: 20px;background: rgba(34,135,251,1);"
                                             @click="OpenaddItem"
                                        >+增加分组
                                        </div>
                                        <!--<el-dialog-->
                                        <!--title="提示"-->
                                        <!--:visible.sync="addItemDispatch"-->
                                        <!--width="30%">-->
                                        <!--<el-form :model="itemTitle" :rules="addItem" ref="itemTitle" label-width="100px"-->
                                        <!--class="demo-ruleForm">-->
                                        <!--<el-form-item label="分组名称" prop="name">-->
                                        <!--<el-input v-model="itemTitle"></el-input>-->
                                        <!--</el-form-item>-->
                                        <!--</el-form>-->
                                        <!--<span slot="footer" class="dialog-footer">-->
                                        <!--<el-button @click="dialogVisible = false">取 消</el-button>-->
                                        <!--<el-button type="primary" @click="addIist('itemTitle')">确 定</el-button>-->
                                        <!--</span>-->
                                        <!--</el-dialog>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <span class="show">显示个人信息</span>
                    <template>
                        <el-radio v-model="radio" label="1">是</el-radio>
                        <el-radio v-model="radio" label="2">否</el-radio>
                    </template>

                    <!--<div class="template_custom">-->
                    <!--<div class="custom_title">自定义模块</div>-->
                    <!--<div class="custom_title">自定义模块</div>-->
                    <!--<div class="custom_remarks">您可以保存8套自定义模块，方便快速配置</div>-->
                    <!--</div>-->
                    <div class="template_save">
                        <el-button type="primary" size="small">保存为自定义模版</el-button>
                    </div>
                </div>
            </div>
            <div class="navigation">
                <div class="module">
                    <div class="module_title">导航模块</div>
                    <div class="module_form" style="margin-top: 50px">
                        <el-form :model="addForm" :rules="rules" ref="addForm" label-width="100px"
                                 class="demo-ruleForm" :hide-required-asterisk="false" v-show="reveal===0">
                            <el-form-item>
                                <div @click="addphoto" style="position: relative">
                                    <img :src="formPic.url"
                                         style="
                                            display: inline-block;
                                            width: 40px;
                                            height: 40px;
                                            background: rgba(241,241,241,1);
                                            border-radius: 20px 20px 20px 20px;"/>
                                    <span style="position: absolute;top:8px;margin-left: 10px">点击修改图标</span>
                                </div>
                                <el-dialog
                                        title="图标修改"
                                        :visible.sync="AddphotoDispatch"
                                        width="30%">
                                    <div>
                                        <div>
                                            <img :src="picId.url"
                                                 style="
                                            display: inline-block;
                                            width: 40px;
                                            height: 40px;
                                            background: rgba(241,241,241,1);
                                            border-radius: 20px 20px 20px 20px;"/>
                                            <span>点击修改图标</span>
                                        </div>
                                        <div style="
                                                margin: 0 auto;
                                                width: 95%;
                                                height: 239px;
                                                background:rgba(249,249,249,1);
                                                border-radius: 5px 5px 5px 5px;
                                                overflow-x: hidden;
                                                 overflow-y: scroll;">
                                            <div style="width: 100%;
                                                            display:flex;
                                                            flex-direction:row;
                                                            flex-wrap:wrap;
                                                            justify-content:space-around;">
                                                        <span v-for="warehouse_pic in warehouse_pictures">
                                                            <img :src="warehouse_pic.alipay_url+warehouse_pic.url"
                                                                 alt=""
                                                                 style="width: 60px;
                                                                 height: 60px;
                                                                 margin: 8px;"
                                                                 @click="append_pic(warehouse_pic.alipay_url+warehouse_pic.url,warehouse_pic.alipay_id)">
                                                        </span>
                                            </div>
                                        </div>
                                    </div>
                                    <span slot="footer" class="dialog-footer">
                                               <!--<el-button type="primary" @click="dialogVisible = false">确 定</el-button>-->
                                               <el-button type="primary" @click="Addpic(picId)">确 定</el-button>
                                               <el-button @click="dialogVisible = false"
                                                          style="color:black">取 消</el-button>
                                            </span>
                                </el-dialog>
                            </el-form-item>

                            <el-form-item label="导航名称" prop="name">
                                <el-input v-model="addForm.name"></el-input>
                            </el-form-item>
                            <el-form-item label="文字介绍" prop="introduce">
                                <el-input v-model="addForm.introduce"></el-input>
                            </el-form-item>
                            <el-form-item label="跳转地址" prop="url">
                                <el-input v-model="addForm.url"></el-input>
                            </el-form-item>
                            <el-form-item label="选择分组" prop="grouping">
                                <el-select v-model="addForm.grouping" placeholder="请选择分组" style="display: block">
                                    <el-option label="生活日常" value="生活日常"></el-option>
                                    <el-option label="线上缴费" value="线上缴费"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="设置热门标签" prop="resource">
                                <el-radio-group v-model="addForm.resource">
                                    <el-radio label=null>不热门</el-radio>
                                    <el-radio label=热门>热门</el-radio>
                                </el-radio-group>
                                <span class="notice"></span>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="submitForm('addForm')">保存到导航库</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form :model="libraryForm" label-width="100px" :rules="rules" ref="libraryForm"
                                 class="demo-libraryForm" :hide-required-asterisk="false" v-show="reveal===1">

                            <el-form-item>
                                <div class="" @click="dialogVisible = true" style="position: relative">
                                    <img :src="libraryForm_url.url"
                                         style="
                                display: inline-block;
                                width: 40px;
                                height: 40px;
                                background: rgba(241,241,241,1);
                                border-radius: 20px 20px 20px 20px;"/>
                                    <span style="position: absolute;top:8px;margin-left: 10px">点击修改图标s</span>
                                </div>
                                <el-dialog
                                        title="图标修改"
                                        :visible.sync="dialogVisible"
                                        width="30%">
                                    <div>
                                        <div>
                                            <img :src="libraryForm_url.url"
                                                 style="
                                display: inline-block;
                                width: 40px;
                                height: 40px;
                                background: rgba(241,241,241,1);
                                border-radius: 20px 20px 20px 20px;"/>
                                            <span>点击修改图标</span>
                                        </div>
                                        <div style="
                                    margin: 0 auto;
                                    width: 95%;
                                    height: 239px;
                                    background:rgba(249,249,249,1);
                                    border-radius: 5px 5px 5px 5px;
                                    overflow-x: hidden;
                                     overflow-y: scroll;">
                                            <div style="width: 100%;
                                                display:flex;
                                                flex-direction:row;
                                                flex-wrap:wrap;
                                                justify-content:space-around;">
                                            <span v-for="warehouse_pic in warehouse_pictures">
                                                <img :src="warehouse_pic.alipay_url+warehouse_pic.url"
                                                     alt=""
                                                     style="width: 60px;
                                                     height: 60px;
                                                     margin: 8px;"
                                                     @click="editend_pic(warehouse_pic.alipay_url+warehouse_pic.url,warehouse_pic.alipay_id)">
                                            </span>
                                            </div>
                                        </div>
                                    </div>
                                    <span slot="footer" class="dialog-footer">
                                   <el-button type="primary" @click="editpic(libraryForm_url)">确 定</el-button>
                                   <el-button @click="dialogVisible = false">取 消</el-button>
                                </span>
                                </el-dialog>
                            </el-form-item>

                            <el-form-item label="导航名称" prop="title">
                                <el-input v-model.title="libraryForm.title"></el-input>
                            </el-form-item>
                            <el-form-item label="文字介绍" prop="value">
                                <el-input v-model="libraryForm.value"></el-input>
                            </el-form-item>
                            <el-form-item label="跳转地址" prop="more_info_url">
                                <el-input v-model="libraryForm.more_info_url"></el-input>
                            </el-form-item>
                            <el-form-item label="选择分组" prop="GroupTitle">
                                <el-select v-model="libraryForm.GroupTitle" placeholder="请选择分组" style="display: block">
                                    <el-option label="生活日常" value="生活日常"></el-option>
                                    <el-option label="线上缴费" value="线上缴费"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="设置热门标签" prop="Tag">
                                <el-radio-group v-model="libraryForm.Tag">
                                    <el-radio label=null>不热门</el-radio>
                                    <el-radio label=热门>热门</el-radio>
                                </el-radio-group>
                                <span class="notice"></span>
                            </el-form-item>

                            <el-form-item>
                                <el-button type="primary" @click="onSubmitForm('libraryForm')">保存到导航库</el-button>
                            </el-form-item>
                        </el-form>
                        <el-form :model="paymentCode" label-width="100px"
                                 class="demo-ruleForm" v-show="reveal===2">

                            <el-form-item label="导航名称">
                                <el-input v-model="paymentCode.text"></el-input>
                            </el-form-item>

                            <el-form-item label="跳转地址">
                                <el-input v-model="paymentCode.url"></el-input>
                            </el-form-item>
                        </el-form>
                        <el-form :model="campusCode" label-width="100px"
                                 class="demo-ruleForm" v-show="reveal===3">

                            <el-form-item label="导航名称">
                                <el-input v-model="campusCode.text"></el-input>
                            </el-form-item>

                            <el-form-item label="跳转地址">
                                <el-input v-model="campusCode.url"></el-input>
                            </el-form-item>


                        </el-form>
                    </div>
                </div>
                <div class="library">
                    <div class="library_title">导航库</div>
                    <div class="library_redact" @click="editLibrary">编辑</div>
                    <div class="library_picture">
                        <div class="library_remarks">双击图标添加导航到左侧功能区</div>
                        <div class="library_border">
                            <div class="library_picbox">
                                <div class="library_box"
                                     style=" width:100%;display:flex; flex-direction:row; flex-wrap:wrap; justify-content:space-around;">
                                    <draggable v-model="column_info_list"
                                               :move="getdata"
                                               @update="datadragEnd"
                                               v-for="(library_pic,index) in library_pictures">
                                        <div :key="index"
                                             style="position: relative;" @dblclick="ChangeMatter(library_pic)">
                                            <img :src="imageDelete" alt="" v-if="show"
                                                 style="position: absolute;top: -10px;left: 36px;"
                                                 @click="Delete(library_pic.ColumId)"
                                            >
                                            <img
                                                    :src="urlData(JSON.parse(library_pic.T_column_info).IconId)"
                                                    style="display:block;margin: 10px 10px;"
                                                    class="library_pic"
                                            >
                                            <div class="pic_name" @click="ChangeMatter(library_pic)">
                                                {{JSON.parse(library_pic.T_column_info).title}}
                                            </div>
                                        </div>
                                    </draggable>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    import draggable from 'vuedraggable';

    export default {
        name: "CardAdmin_set",
        data() {
            return {
                imgPhone: require('../../../assets/images/phone.png'),
                imageUrl: require('../../../assets/images/circle.png'),
                imageDelete: require('../../../assets/images/delete.jpg'),
                imageback: '',


                radio: '1',//热门标签
                show: false,//删除标识切换
                reveal: 0,//from切换
                layout: 0,//显示模式切换
                itemTitle: "",
                // addItemDispatch: false,
                // addItem: {
                //     name: [
                //         {required: true, message: '请输入活动名称', trigger: 'blur'},
                //         {min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur'}
                //     ],
                // },

                phoneSurface: {},//获取手机页面
                column_info_list: [],//分组列表
                card_action_list: [],//付款码`校园码
                paymentCode: {},//付款码
                campusCode: {},//校园码
                listpic: {},//手机模块图片url
                AlterDispatch: false,//修改分组名称弹窗
                AlterForm: {
                    name: ''
                },
                rule: {
                    name: [
                        {required: true, message: '请输入导航名称', trigger: 'blur'},
                        {min: 1, max: 4, message: '长度在 1 到 4 个字符', trigger: 'blur'}
                    ],
                },


                warehouse_pictures: [],//获取图片列表
                picback_data: {
                    'Index': "1",
                    'name': "88",
                    'school_id': localStorage.schoolcode
                },//手机背景图传值
                library_pictures: [],//获取导航库

                //新增表单
                AddphotoDispatch: false,
                picId: {},
                formPic: {},
                addForm: {
                    image: '',
                    name: '',
                    introduce: '',
                    url: '',
                    grouping: '',
                    resource: '',
                },
                rules: {
                    image: [
                        {required: true, message: '请输入导航名称', trigger: 'blur'},
                    ],
                    name: [
                        {required: true, message: '请输入导航名称', trigger: 'blur'},
                        {min: 1, max: 4, message: '长度在 1 到 4 个字符', trigger: 'blur'}
                    ],
                    introduce: [
                        {required: true, message: '请输入文字介绍', trigger: 'blur'},
                    ],
                    url: [
                        {required: true, message: '请输入地址', trigger: 'blur'},
                    ],
                    grouping: [
                        {required: true, message: '请选择活动区域', trigger: 'change'}
                    ],
                    resource: [
                        {required: true, message: '请选择活动资源', trigger: 'change'}
                    ],

                },
                // 修改表单
                libraryData: {},
                dialogVisible: false,
                libraryForm_url: {},
                editformPic: {},
                libraryForm: {},


                typetitle: [],//类型标题push成数组
                typenames: [],//类型标题去重后的数组
                dataUrl: ""
            }
        },
        created() {
            this.init()
        },
        methods: {
            init() {
                let id = this.$route.params.id

                //  获取图片列表
                this.axios.post(`api/SchoolCodr/GetIconList`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(res => {
                    this.warehouse_pictures = res.data.data
                    console.log(this.warehouse_pictures)
                })

                // 获取手机页面
                const data = {
                    "school_id": localStorage.schoolcode,
                    "card_add_id": id
                }
                this.axios.post(`api/SchoolCodr/GetSschoolTemp`, data, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(res => {
                    this.phoneSurface = res.data
                    console.log(res.data)

                    this.column_info_list = res.data.column_info_list
                    // console.log(this.column_info_list)
                    this.column_info_list.map(listpic => {
                        this.warehouse_pictures.map(item => {
                            if (listpic.IconId == item.alipay_id) {
                                let listpic = item.alipay_url + item.url
                                let id = item.alipay_id
                                this.listpic = {url: listpic, id: id}
                                // console.log(this.listpic)
                                return
                            }
                        })
                    })
                    this.card_action_list = res.data.card_action_list
                    this.card_action_list.map(item => {
                        if (item.text === "付款码") {
                            this.paymentCode = {text: item.text, url: item.url}
                        } else {
                            this.campusCode = {text: item.text, url: item.url}
                        }
                    })
                    if (res.data.layout === "grid") {
                        this.layout = 0
                    } else {
                        this.layout = 1
                    }
                    this.column_info_list.map(item => {
                        this.typetitle.push({GroupTitle:item.GroupTitle})
                    })
                    let array = Array.from(new Set(this.typetitle));
                    console.log(array);
                    this.typenames = array

                    // this.column_info_list.map(res => {
                        this.typenames[0].push[res]
                    // })
                    console.log(this.typenames)


                })

                // 获取导航库
                const library_data = {
                    "school_id": localStorage.schoolcode,
                }
                this.axios.post(`api/SchoolCodr/GetSchoolCardColumn`, library_data, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(res => {
                    this.library_pictures = res.data
                    console.log(this.library_pictures)
                    this.library_pictures.map(item => {

                    })
                })
            },

            getdata(evt) {
                console.log(evt.draggedContext.element.id)
            },
            datadragEnd(evt) {
                console.log('拖动前的索引 :' + evt.oldIndex)
                console.log('拖动后的索引 :' + evt.newIndex)
                console.log(this.column_info_list)
            },

            // 手机背景
            handleAvatarSuccess(res, file) {
                this.imageback = URL.createObjectURL(file.raw);
                console.log(res)
                console.log(file)
            },
            beforeAvatarUpload(file) {
                const isJPG = file.type === 'image/jpeg';
                const isLt2M = file.size / 1024 / 1024 < 2;

                if (!isJPG) {
                    this.$message.error('上传头像图片只能是 JPG 格式!');
                }
                if (!isLt2M) {
                    this.$message.error('上传头像图片大小不能超过 2MB!');
                }
                return isJPG && isLt2M;
            },
            // 校徽
            // handleAvatarSuccess(res, file) {
            //     this.imageUrl = URL.createObjectURL(file.raw);
            // },
            // beforeAvatarUpload(file) {
            //     const isJPG = file.type === 'image/jpeg';
            //     const isLt2M = file.size / 1024 / 1024 < 2;
            //
            //     if (!isJPG) {
            //         this.$message.error('上传头像图片只能是 JPG 格式!');
            //     }
            //     if (!isLt2M) {
            //         this.$message.error('上传头像图片大小不能超过 2MB!');
            //     }
            //     return isJPG && cisLt2M;
            // },
            // 点击付款码
            SelectedPaymentcode() {
                this.reveal = 2
            },
            SelectedCampuscode() {
                this.reveal = 3
            },
            deleteIcon(index) {
                console.log(index)
                this.typenames.splice(index, 1)
            },
            DeleteItem(index) {
                this.column_info_list.splice(index, 1)
            },
            OpenaddItem() {
                // this.addItemDispatch = true
                this.column_info_list.push({
                        "GroupTitle": "55",
                        "IconId": "",
                        "Tag": "null",
                        "code": "T2018WH10",
                        "more_info_title": "JSON",
                        "more_info_url": "",
                        "operate_type": "openWeb",
                        "title": "",
                        "value": ""
                    }
                )
                console.log(this.phoneSurface)

            },
            // addIist(formName) {
            //
            //     this.$refs[formName].validate((valid) => {
            //         if (valid) {
            //
            //             this.$refs[formName].resetFields();
            //             this.addItemDispatch=false
            //         } else {
            //             console.log('error submit!!');
            //             return false;
            //         }
            //     });
            // },
            // addresetForm(formName) {
            //     this.addItemDispatch=false
            //     this.$refs[formName].resetFields();
            // },

            addnavigation() {
                this.reveal = 0
            },
            Changenavigation(data) {
                this.reveal = 1,
                    this.libraryData = data
                this.libraryForm = data
                console.log(data)
                this.warehouse_pictures.map(res => {
                    if (data.IconId === res.alipay_id) {
                        let libraryForm_url = res.alipay_url + res.url
                        this.libraryForm_url.url = libraryForm_url
                        return;
                    }
                })
            },
            alter(title) {
                console.log(title)
                this.AlterForm.name = title
                this.AlterDispatch = true;
            },
            handleClose(done) {
                this.$confirm('确认关闭？')
                    .then(_ => {
                        done();
                    })
                    .catch(_ => {
                    });
            },

            addphoto() {
                this.AddphotoDispatch = true
            },
            append_pic(url, id) {
                this.picId = {url: url, id: id}
            },

            // 表单头像
            Addpic(picId) {
                console.log(picId)
                this.formPic = picId
                this.AddphotoDispatch = false
            },
            // 提交表单
            submitForm(addForm) {
                this.$refs[addForm].validate((valid) => {
                    if (valid) {
                        const module_data = {
                            "school_id": localStorage.schoolcode,
                            "T_column_info": {
                                "code": "T2018WH10",
                                "operate_type": "openWeb",
                                "title": this.addForm.name,
                                "value": this.addForm.introduce,
                                "more_info_title": "JSON",
                                "more_info_url": this.addForm.url,
                                "IconId": this.formPic.id,
                                "GroupTitle": this.addForm.grouping,
                                "Tag": this.addForm.resource,
                            }
                        }
                        console.log(module_data)
                        this.axios.post(`/api/SchoolCodr/AddSchoolCardColum`, module_data, {
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        }).then(res => {
                            console.log(res)
                            this.$refs[addForm].resetFields();
                            this.init()
                        })
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            // 点击导航栏头像
            ChangeMatter(data) {
                this.reveal = 1,
                    this.libraryData = data
                this.libraryForm = JSON.parse(data.T_column_info)
                console.log(data)
                this.column_info_list.push(this.libraryForm)
                this.warehouse_pictures.map(res => {
                    if (this.libraryForm.IconId === res.alipay_id) {
                        let libraryForm_url = res.alipay_url + res.url
                        this.libraryForm_url.url = libraryForm_url
                        return;
                    }
                })
            },
            editend_pic(url, id) {
                this.libraryForm_url = {url: url, id: id}
                console.log(this.libraryForm_url)
            },
            editpic(libraryForm_url) {
                this.editformPic = libraryForm_url
                this.dialogVisible = false
            },

            onSubmitForm(libraryForm) {
                console.log(libraryForm);
                console.log(this.libraryForm)
                this.$refs[libraryForm].validate((valid) => {
                        if (valid) {
                            const module_data = {
                                "ColumId": this.libraryData.ColumId,
                                "T_column_info":
                                this.libraryForm
                            }
                            console.log(module_data)
                            this.axios.post(`/api/SchoolCodr/UpdateSchoolCardColum`, module_data, {
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            }).then(res => {
                                console.log(res)
                                this.reveal = 0
                                this.init()
                            })

                        }
                    }
                )
                ;
            },
            editLibrary: function () {
                this.show = !this.show
            }
            ,

            // 删除
            Delete(id) {
                console.log(id)
                const Delete_data = {
                    "ColumId": id,
                    "school_id": localStorage.schoolcode,
                }
                this.axios.post(`api/SchoolCodr/DelSchoolCardColum`, Delete_data, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(res => {
                    this.init()
                })

            }
            ,
            // 立即发布
            ImmediatelyRelease() {
                const Release_data = {
                    "school_id": localStorage.schoolcode,
                    "baseinfoshow": 0,
                    "card_add_id": this.$route.params.id,
                    "card_action_list": this.card_action_list,
                    "column_info_list": this.column_info_list
                }
                console.log(Release_data)
                this.axios.post(`/api/SchoolCodr/UpdateSchoolCard`, Release_data, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(res => {
                    console.log(res)
                    this.$router.push({name: "CardAdmin"})
                })
            }
            ,
            xxx(id) {
                return this.warehouse_pictures.map(list => {
                    if (id == list.alipay_id) {
                        this.vvv = list.alipay_url + list.url
                        // console.log(list.alipay_url + list.url)
                    }
                });
            },

            // getUrls(id) {
            //     console.log(id)
            //     for (var i = 0; i <this.warehouse_pictures.length; i++) {
            //         var obj = this.warehouse_pictures[i];
            //         console.log(id(obj.alipay_id).url);
            //     }
            // },
            // getapp:function(){
            //
            // }
            urlData: function (id) {
                this.dataUrl = "";
                // console.log(this.warehouse_pictures[58].alipay_id)
                // if (id=== this.warehouse_pictures[this.warehouse_pictures.length].alipay_id){
                //     console.log(123)
                // }
                this.dataUrl = this.warehouse_pictures.map(item => {
                    // console.log(item)
                    if (id == item.alipay_id) {
                        return item.alipay_url + item.url;
                    }
                }).join(',');
                // console.log(this.dataUrl)
                return

                // if (id === this.warehouse_pictures[alipay_id]) {

                // }
            },

            // arr2Map(id) {
            //     var map = new Object();
            //     for (var i = 0; i < this.warehouse_pictures.length; i++) {
            //         var obj = this.warehouse_pictures[i];
            //         // console.log(obj)
            //         map[obj.alipay_id] = obj;
            //         // console.log(map[obj.alipay_id] = obj)
            //
            //         // console.log(map["0vuDx8UbQeKhTbXAgPCwtgAAACMAAQED"].alipay_url)
            //
            //     }
            //     // this.lll.push(map)
            //     // console.log(this.lll)
            //     // console.log(map[alipay_id].alipay_url)
            //     // return map[id].alipay_url
            // }
        },

        components: {
            draggable
        },


    }
</script>

<style lang="scss" scoped>
    .phone_payment {
        margin-top: 10px;
    }

    .phone_campus {
        margin-top: 10px;
    }

    .phone_campus_title > span {
        padding-left: 10px;
        color: rgba(34, 135, 251, 1);
    }

    .addFunction {
        width: 100%;
        height: 80px;
        background: rgba(241, 241, 241, 1);
    }

    .addFunction {
        position: relative;
        border-radius: 8px;
    }

    .addFunction span {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        white-space: nowrap
    }

    .home {
        height: 100%;
    }

    .active {
        background-color: rgba(35, 135, 251, 1);
        color: #ffffff;
    }

    /*顶部导航*/
    .nav {
        height: 60px;
        text-align: left;
        background-color: #fff;
        padding: 0 30px;
        display: flex;
        justify-content: space-between;
    }

    .nav_bread {
        display: flex;
    }

    .details {
        margin-top: 15px;
        margin-right: 25px;
        border: 1px solid #2387fb;
        width: 100px;
        height: 30px;
    }

    .det_btn {
        color: #2387fb !important;
        padding-bottom: 2px;
    }

    .el-breadcrumb {
        line-height: 39px;
        color: #707070;
        padding-top: 10px;
        margin-right: 10px;
    }

    .release {
        margin-top: 15px;
    }

    /*主体*/
    .container {
        display: flex;
        margin: 30px 60px 0 60px;
    }

    .container > div {
        background-color: #fff;
        margin: 0 5px;
    }

    /*卡包设置*/

    .card_set {
        flex: 1;
    }

    .al_set {
        margin: 20px 31px 0 31px;
    }

    .al_title {
        font-size: 16px;
    }

    .template_title {
        font-size: 16px;
        color: #2287fb;
        margin-top: 20px;
    }

    /*手机*/
    .phone {
        width: 235px;
        margin-top: 20px;
    }

    .template_phone {
        background-image: url("../../../assets/images/phone.png");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        width: 100%;
        height: 450px;
        position: relative;
    }

    .phone_border {
        position: absolute;
        width: 87%;
        height: 343px;
        margin: 0 auto;
        top: 53px;
        left: 16px;
        overflow-x: hidden;
        overflow-y: scroll;
    }

    .template_custom {
        margin-top: 10px;
    }

    .custom_remarks {
        font-size: 12px;
        color: rgba(112, 112, 112, 0.5);
    }

    .custom_title div {
        margin-top: 10px;
    }

    .template_save {
        text-align: center;
        margin-top: 30px;
    }

    /*手机内*/
    /*背景*/

    avatar-uploader > div {
        width: 100%;
        height: 110px;
        background-color: rgba(241, 241, 241, 1);
        border-radius: 10px 10px 10px 10px;
    }

    .avatar-uploader .el-upload {
        border: 1px dashed #d9d9d9;
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .avatars-uploader-icon {
        font-size: 28px;
        color: #8c939d;
        height: 178px;
        line-height: 178px;
        text-align: center;
    }

    .avatar {
        width: 178px;
        height: 178px;
        display: block;
    }

    /*校徽*/
    /*.avatar-uploader .el-upload {*/
    /*border: 1px dashed #d9d9d9;*/
    /*border-radius: 6px;*/
    /*cursor: pointer;*/
    /*position: relative;*/
    /*overflow: hidden;*/
    /*}*/

    /*.avatar-uploader .el-upload:hover {*/
    /*border-color: #409EFF;*/
    /*}*/

    /*.avatar-uploader-icon {*/
    /*font-size: 28px;*/
    /*color: #8c939d;*/
    /*width: 178px;*/
    /*height: 178px;*/
    /*line-height: 178px;*/
    /*text-align: center;*/
    /*}*/

    .avatar {
        width: 178px;
        height: 178px;
        display: block;
    }

    .phone_payment {
        height: 32px;
        opacity: 1;
        background: rgba(241, 241, 241, 1);
        border-radius: 10px 10px 10px 10px;
        border: 1px solid rgba(112, 112, 112, 0.2);
        display: flex;
        justify-content: space-around;
    }

    .phone_payment > div {
        flex: 1;
        text-align: center;
        margin: 5px;
        color: rgba(112, 112, 112, 1);
    }

    .paymentCode {
        border-right: 1px solid rgba(112, 112, 112, 0.2);
    }

    /*导航模块*/
    .navigation {
        flex: 4;
        display: flex;
        justify-content: space-between;
    }

    .module {
        flex: 3;
        margin: 32px 20px 28px 50px;
    }

    .module_title {
        font-size: 16px;
        color: #323232;
    }

    /*上传图标*/

    /*导航库*/
    .library {
        flex: 2;
        margin: 32px 80px 28px 20px;
    }

    .library_title {
        font-size: 16px;
        color: #323232;
    }

    .library_redact {
        font-size: 14px;
        color: #2387fb;
        text-align: right;
        margin: 30px 0 10px 0;
    }

    .library_picture {
        width: 100%;
        height: 600px;
        background-color: #f9f9f9;
        border-radius: 5px;
        border: solid 1px rgba(112, 112, 112, 0.2);

    }

    .library_border {
        overflow-x: hidden;
        overflow-y: scroll;
        width: 100%;
        height: 567px;
    }

    .library_remarks {
        margin: 7px;
        line-height: 19px;
        color: rgba(112, 112, 112, 0.5);
        text-align: center;
    }

    .library_pic {
        width: 70px;
        height: 70px;
    }

    .pic_name {
        margin-top: 10px;
        text-align: center;
    }
</style>