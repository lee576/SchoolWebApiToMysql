<template>
    <div class="home">
        <div class="nav-lead clearfix">
            <div class="fl nav-lead-word"><a href="#">学校功能设置</a></div>
        </div>
        <div class="page-content">
            <div class="add-page-box">
                <div class="add-page">
                    <div class="add-page-title">学校功能设置</div>
                    <el-form :model="sfunctionForm" :rules="sfunctionrules" ref="sfunctionForm" label-width="110px"
                             class="demo-ruleForm">
                        <div class="gray-box-part">
                            <el-form-item label="项目编号" prop="project_no">
                                <el-input v-model="sfunctionForm.project_no" placeholder="请输入项目编号"></el-input>
                            </el-form-item>
                            <el-form-item label="禧云编号" prop="xiyuncode">
                                <el-input v-model="sfunctionForm.xiyuncode" placeholder="请输入禧云编号"></el-input>
                                <div class="xaccount-tip">可输入多个项目编号，用逗号隔开</div>
                            </el-form-item>

                        </div>
                        <!--<el-form-item label="是否授权" prop="grant">-->
                        <!--<el-switch v-model="sfunctionForm.grant"></el-switch>-->
                        <!--</el-form-item>-->
                        <!--<el-form-item label="是否分批支付" prop="batches">-->
                        <!--<el-switch v-model="sfunctionForm.batches"></el-switch>-->
                        <!--</el-form-item>-->
                        <el-form-item>
                            <el-button class="btn-bg" @click="edit('sfunctionForm')">修改</el-button>
                            <el-button class="btn-border" @click="cancel('sfunctionForm')">取消</el-button>
                        </el-form-item>
                    </el-form>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    export default {
        name: "SchoolFunction",
        data() {
            return {
                sfunctionForm: {
                    project_no: '',
                    xiyuncode: '',
                }, sfunctionrules: {
                    project_no: [
                        {required: true, message: '请输入项目编号', trigger: 'blur'}
                    ], xiyuncode: [
                        {required: true, message: '请输入禧云编号', trigger: 'blur'}
                    ]
                }
            }
        },
        created() {
            this.init()
        },
        methods: {
            init() {
                this.axios.get(`/api/SchoolUser/GetSchoolSZ`, {
                    params: {
                        schoolid: localStorage.schoolcode
                    }
                }).then(res => {
                    console.log(res)
                    if (res.data.code == "000000") {
                        this.sfunctionForm = res.data
                    } else {
                        // 获取信息失败
                        this.$message.error(res.data.msg);
                    }

                })
            },

            edit(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.axios.get(`/api/SchoolUser/EditSchoolSZ`, {
                            params: {
                                schoolid: localStorage.schoolcode,
                                project_no: this.sfunctionForm.project_no,
                                xiyunMCode: this.sfunctionForm.xiyuncode
                            }
                        }).then(res => {
                            if (res.data.code = "000000") {
                                this.$message({
                                    message: res.data.msg,
                                    type: 'success'
                                });
                                this.init()
                            } else {
                                this.$message.error(res.data.msg);
                            }
                            console.log(res)
                        })
                    } else {
                        this.$message.error('请检查表单');
                    }
                });
            },
            cancel(formName) {
                this.$refs[formName].resetFields();
                this.init()
            }
        },

    }
</script>

<style scoped>

</style>